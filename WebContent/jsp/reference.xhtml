<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"> 
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui">

	  
    <f:view contentType="text/html">
    <h:head>
        <title>DOI Lookup</title>
    </h:head>
    <h:body>
    <h:form id="editForm">
    	<p:ajaxStatus onstart="statusDialog.show();" onsuccess="statusDialog.hide();"/>  
        <p:dialog modal="true" widgetVar="statusDialog" header="Please Wait ..."   
       		draggable="false" closable="false">  
    		<p:graphicImage value="/images/loading.gif" />  
		</p:dialog>  
    	<p:dataTable id="refDataTable" var="reference"
                value="#{referenceBean.references}" paginator="true"
                rows="10" 
                rowKey="#{reference.refNum}"
                paginatorTemplate="{RowsPerPageDropdown} {FirstPageLink} {PreviousPageLink} {CurrentPageReport} {NextPageLink} {LastPageLink}"
                rowsPerPageTemplate="5,10,15"
                selection="#{referenceBean.selectedReference}"
                selectionMode="single" onRowSelectUpdate="display">
				<p:ajax event="rowSelect" update="editRef" />
				 <p:ajax event="rowUnselect" update="editRef" />
                <p:column sortBy="#{reference.doi}" filterBy="#{reference.doi}">
                    <f:facet name="header">
                        <h:outputText value="DOI" />
                    </f:facet>
                    <f:facet name="header">PetDB Reference DOI Lookup</facet>
                    <h:outputText value="#{reference.doi}" />
                </p:column>
                <p:column sortBy="#{reference.title}"  filterBy="#{reference.title}"
                	filterMatchMode="contains">
                    <f:facet name="header">
                        <h:outputText value="Title" />
                    </f:facet>
                    <h:outputText value="#{reference.title}" />
                </p:column>
                <p:column sortBy="#{reference.journal}" filterBy="#{reference.journal}"
                	filterMatchMode="contains">
                    <f:facet name="header">
                        <h:outputText value="Journal" />
                    </f:facet>
                    <h:outputText value="#{reference.journal}" />
                </p:column>
                <p:column sortBy="#{reference.volume}">
                    <f:facet name="header">
                        <h:outputText value="Volume" />
                    </f:facet>
                    <h:outputText value="#{reference.volume}" />
                </p:column>
                <p:column sortBy="#{reference.issue}" headerText="Issue">
                    <h:outputText value="#{reference.issue}" />
                </p:column>
                               
                <p:column sortBy="#{reference.status}" filterBy="#{reference.status}"
                    headerText="Status"
                    filterOptions="#{referenceBean.statusOptions}"  
                	filterMatchMode="exact" filterStyle="width:200px;">
                    <h:outputText value="#{reference.status}" />
                </p:column>
                <f:facet name="footer">  
				    <p:commandButton id="editRef" value="View/Edit"  
				    	actionListener="#{referenceBean.doEdit}"
				    	update=":detailForm:refData" 
				    	disabled="#{empty referenceBean.selectedReference}"
			    		oncomplete="referenceDialog.show()"/>    
					<p:commandButton id="addRef" value="Add"  
				    	actionListener="#{referenceBean.doAdd}"
			    		oncomplete="doiDialog.show()"/>
	  			</f:facet>  
            </p:dataTable>				           		
     </h:form>
     <h:form id="addForm">
    <p:dialog header="Please enter DOI" widgetVar="doiDialog" showEffect="fade" hideEffect="fade" modal="true">  
        <p:panel id="doiPanel">
        	<p:messages id="mainMsgs" showDetail="true" autoUpdate="true" />
	    	<p:inputText id="doi" value="#{referenceBean.doi}" size="35"/>   						
			<p:commandButton id="submit" value="Look Up" update=":detailForm:refData,doiPanel" 
				actionListener="#{referenceBean.doSubmit}"
				oncomplete="handleSubmitRequest(xhr, status, args)"/> 
    	</p:panel>
    </p:dialog>
     </h:form>
     <script type="text/javascript">  
    function handleSubmitRequest(xhr, status, args) {  
        if(args.validDoi) {  
            referenceDialog.show();  
            doiDialog.hide();
        }  
        else
        {
        	referenceDialog.hide();  
            doiDialog.show();
        }
        
    }  
    function handleSaveRequest(xhr, status, args) {  
        if(args.validRefNum) {  
            referenceDialog.hide(); 
            doiDialog.hide();
        }  
        else
        {
        	referenceDialog.show();  
        	doiDialog.hide();
        }
        
    }  
</script>  
     <h:form id="detailForm">
    <p:dialog header="Reference" widgetVar="referenceDialog" showEffect="fade" hideEffect="fade" modal="true">
    	<p:panel id="refData"> 
    		<p:messages id="dialogMsgs" showDetail="true" autoUpdate="true" />
		    <p:panelGrid>
		        <p:row>  
		            <p:column colspan="1"><h:outputText value="DOI: " /></p:column> 
		            <p:column colspan="1"><p:inputText value="#{referenceBean.reference.doi}"/></p:column> 
		            <p:column colspan="1"><h:outputText value="Ref Number:" /></p:column> 
		            <p:column colspan="1">
		            	<p:inputMask id="refNumField" mask="9999" value="#{referenceBean.reference.refNum}" required="true" 
		            		rendered ="#{referenceBean.isNew}" />
		            	<h:outputText value="#{referenceBean.reference.refNum}"
		             		rendered="#{not referenceBean.isNew}"/>
		            </p:column>
		        </p:row> 
		        <p:row>  
		            <p:column colspan="1"><h:outputText value="Title: " /></p:column> 
		            <p:column colspan="3">
		            	<h:inputTextarea id="abstract" 
		                            value="#{referenceBean.reference.title}"
		                            rows="5" cols="70" autoResize="true" />
		            </p:column> 
		        </p:row> 
		        <p:row>  
		            <p:column colspan="1"><h:outputText value="Volume: " /></p:column> 
		            <p:column colspan="1"><p:inputText value="#{referenceBean.reference.volume}"/></p:column> 
		            <p:column colspan="1"><h:outputText value="Issue:" /></p:column> 
		            <p:column colspan="1"><p:inputText value="#{referenceBean.reference.issue}"/></p:column>
		        </p:row> 
		        <p:row>  
		            <p:column colspan="1"><h:outputText value="First Page:" /></p:column> 
		            <p:column colspan="1"><p:inputText value="#{referenceBean.reference.firstPage}"/></p:column> 
		            <p:column colspan="1"><h:outputText value="Last Page:" /></p:column> 
		            <p:column colspan="1"><p:inputText value="#{referenceBean.reference.lastPage}"/></p:column>
		        </p:row> 
		        <p:row>  
		            <p:column colspan="1"><h:outputText value="Journal:" /></p:column> 
		            <p:column colspan="3"><p:inputText value="#{referenceBean.reference.journal}" style="width: 98%"/></p:column> 
		        </p:row> 
		        <p:row>  
		            <p:column colspan="1"><h:outputText value="Book Title:" /></p:column> 
		            <p:column colspan="1"><p:inputText value="#{referenceBean.reference.bookTitle}"/></p:column> 
		            <p:column colspan="1"><h:outputText value="Book Editor:" /></p:column> 
		            <p:column colspan="1"><p:inputText value="#{referenceBean.reference.bookEditor}"/></p:column>
		        </p:row> 
		        <p:row>  
		            <p:column colspan="1"><h:outputText value="Publisher:" /></p:column> 
		            <p:column colspan="3"><p:inputText value="#{referenceBean.reference.publisher}" style="width: 98%"/></p:column> 
		        </p:row> 
		        <p:row> 
		             <p:column colspan="1"><h:outputText value="Publish Year:" /></p:column> 
		            <p:column colspan="1"><p:inputText value="#{referenceBean.reference.pubYear}"/></p:column>
		            <p:column colspan="1"><h:outputText value="Status" /></p:column> 
		            <p:column colspan="1">
		            	<p:selectOneMenu id="statusOptions" value="#{referenceBean.reference.status}">    
			            	<f:selectItems value="#{referenceBean.statuses}" var="statusOption" itemLabel="#{statusOption}" itemValue="#{statusOption}"/>  
			        	</p:selectOneMenu>
		            </p:column>
		         </p:row> 
		         <p:row>  
		            <p:column colspan="1"><h:outputText value="Data Entered:" /></p:column> 
		            <p:column colspan="1"><p:inputText value="#{referenceBean.reference.dataEntered}"/></p:column> 
		            <p:column colspan="1"><h:outputText value="Entered Date:" /></p:column> 
		            <p:column colspan="1">
		            	<p:calendar value="#{referenceBean.reference.dataEnteredDate}" showOn="button" />  
		            </p:column>
		        </p:row>
		         <p:row>  
		            <p:column colspan="1"><h:outputText value="Public Comment:" /></p:column> 
		            <p:column colspan="3"><p:inputText value="#{referenceBean.reference.publicComment}" style="width: 98%"/></p:column> 
		        </p:row>
		        
		         </p:panelGrid>
         </p:panel>
         <f:facet name="footer">  
				    <p:commandButton id="save" value="Save"  
				    	actionListener="#{referenceBean.doSave}"
				    	update="refData,:editForm:refDataTable"
			    		oncomplete="handleSaveRequest(xhr, status, args)"/>    
	  	 </f:facet>  
    </p:dialog>  
      </h:form>
   </h:body>
	
    </f:view>
    
</html>
